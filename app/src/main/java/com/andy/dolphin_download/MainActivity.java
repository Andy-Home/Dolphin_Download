package com.andy.dolphin_download;

import android.os.Bundle;
import android.support.design.widget.FloatingActionButton;
import android.support.v7.app.AppCompatActivity;
import android.view.View;
import android.widget.ListView;

import com.andy.dolphin.DolphinObserver;
import com.andy.dolphin.DownloadManager;
import com.andy.dolphin.task.Task;
import com.andy.dolphin.task.TaskManager;

import java.util.ArrayList;
import java.util.List;

public class MainActivity extends AppCompatActivity implements DolphinObserver {
    private ListView mListView;
    private List<Task> mTasks = new ArrayList<>();
    private String[] urlList = {"http://downloads.gradle.org/distributions/gradle-4.0.2-src.zip",
            "https://github.com/Andy-Home/Rabbit_Log/archive/master.zip",
            "https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1501954103056&di=ddf8af86453492d129d51a7c05298349&imgtype=0&src=http%3A%2F%2Fdynamic-image.yesky.com%2F740x-%2FuploadImages%2F2015%2F154%2F20%2F6YL92HH61434.jpg",
            "data:image/png;base64,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"};
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        DownloadManager.getInstance(this);
        TaskManager.getInstance().attach(this);
        findView();
    }

    private DownloadAdapter mAdapter;

    private void findView() {

        mListView = (ListView) findViewById(R.id.list);

        mAdapter = new DownloadAdapter(mTasks);
        mListView.setAdapter(mAdapter);
        FloatingActionButton fab = (FloatingActionButton) findViewById(R.id.fab);
        fab.setOnClickListener(new View.OnClickListener() {
            int flag = 0;
            @Override
            public void onClick(View view) {
                DownloadManager.download(urlList[(flag++) % 4]);
            }
        });
    }

    @Override
    public void update(int type, Task task) {
        if (type == TaskManager.PROGRESS) {
            int position = mTasks.indexOf(task);
            /**第一个可见的位置**/
            int firstVisiblePosition = mListView.getFirstVisiblePosition();
            /**最后一个可见的位置**/
            int lastVisiblePosition = mListView.getLastVisiblePosition();

            /**在看见范围内才更新，不可见的滑动后自动会调用getView方法更新**/
            if (position >= firstVisiblePosition && position <= lastVisiblePosition) {
                /**获取指定位置view对象**/
                View view = mListView.getChildAt(position - firstVisiblePosition);
                mAdapter.getView(position, view, mListView);
            }
        } else {
            mTasks.clear();
            mTasks.addAll(TaskManager.getInstance().getTaskList());
            mAdapter.notifyDataSetChanged();
        }
    }

    @Override
    protected void onDestroy() {
        super.onDestroy();
        TaskManager.getInstance().detach(this);
    }
}
